//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Author      :   Pierre BLACHÉ                                       &&&
//&&&   Date        :   14 July 2014                                        &&&
//&&&   Version     :   v1.0                                                &&&
//&&&   File        :   cy7c42x1.h                                          &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Description :   - Handles FIFO from Cypress                         &&&
//&&&                   - Support all Cy7C42xx family                       &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Infos       :   -                                                   &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Hystory     :   v1.0    14/07/14    Creation                        &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&


#include "cy7c42x1.h"

extern u8  io_port2;

//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//--------------------------------- Reset -------------------------------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
void cy7c42x1_reset ()
{
    PIN_FIFO_RSTn = 1;
    PIN_FIFO_RSTn = 0;
    Nop();
    Nop();
    Nop();
    PIN_FIFO_RSTn = 1;
}


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//--------------------------------- Flush -------------------------------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
void cy7c42x1_flush ()
{
    u32 loop = 0;

    PIN_FIFO_WR_ENn = 1;  // don't write anything into the fifo during flushing
    FIFO_RD_EN_ON;

    for (loop = 0; loop < 130000; loop++)
    {
        cy7c42x1_do_read_clock();   // takes about 160 us
    }

    FIFO_RD_EN_OFF;
}


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//------------------------------- Read Clock ----------------------------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
inline void cy7c42x1_do_read_clock()
{
    PIN_FIFO_RD_CLK = 0;
    Nop();                  // a nop takes 25 ns @ 40 MIPS
    PIN_FIFO_RD_CLK = 1;
    Nop();
}


