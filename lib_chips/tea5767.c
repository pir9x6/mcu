//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Title           :   FM Receiver TEA5767                             &&&
//&&&   Autor           :   Pierre Blaché                                   &&&
//&&&   Date            :   May 2014                                        &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//&&&   Versions        :   v1.0 - 14/05/25 - Creation                      &&&
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

#include "i2c.h"
#include "tea5767.h"

//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//------------------------- Initialisation du TEA5767 -------------------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
void tea5767_init (void)
{
    u16 pll;
    pll = tea5767_pll_calculation(10430);
    tea5767_write (pll/256, pll%256, 0x01, 0x90, 0x00);
}


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//--------- Calcul de la PLL en fonction de la fréquence à recevoir------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
u16 tea5767_pll_calculation (u16 freq)
{
    return (u16)(((freq*10-225)*4000)/32768);
}


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
//--------------------- Ecrire une donnée sur le TEA5767 ----------------------
//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
void tea5767_write (u8 data1, u8 data2, u8 data3, u8 data4, u8 data5)
{
    i2c_start();
    i2c_write(I2C_ADR_TEA5767<<1 & 0xFE);
    i2c_write(data1);
    i2c_write(data2);
    i2c_write(data3);
    i2c_write(data4);
    i2c_write(data5);
    i2c_stop();
}

